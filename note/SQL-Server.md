# SQL Server

## 一、数据库对象

### 1. 表

一行一条记录

一列一个字段

### 2. 视图

虚拟的表

从实际存在的表中提取数据，而不需要得知真实的表，提高了安全性

### 3. 索引

目录，提高查询速度

分为聚集索引(主键索引)和非聚集索引

### 4. 存储过程

把数据库操作的过程存储到一个对象中，可以提高数据库安全性

### 5. 触发器

达成某一条件后，执行的操作

## 二、安装

### Windows安装

#### 1.准备

设置hostname

创建Windows用户, 在该用户下运行安装程序 (会成为SQL Server的管理用户)

#### 2.运行安装程序

```powershell
C:\SQL2019\Developer_CHS\SETUP.EXE
```

✔️ 数据库引擎服务

✔️ SQL Server 复制

✔️ 混合模式+密码

一路下一步即可

#### 3.配置TCP/IP连接

打开配置管理器

```powershell
C:\Windows\SysWOW64\mmc.exe
```

SQL Server 网络配置 > MSSQLSERVER 的协议 > TCP/IP 启用

SQL Server 网络配置 > MSSQLSERVER 的协议 > TCP/IP 属性 > IP地址 > IPALL 端口 1433 > 确定

#### 4.重启SQL Server

打开配置管理器

```powershell
C:\Windows\SysWOW64\mmc.exe
```

SQL Server 服务 > SQL Server (MSSQLSERVER) > 重启

#### 5.安装SSMS(Microsoft SQL Server Management Studio)

开启TCP/IP后，可以不在同一台计算机登陆数据库实例

登录格式↓

```powershell
192.168.51.23,1433\MSSQLSERVER
```

## 三、性能查询

查询SQL SERVER 的运行情况

```sql
SELECT * 
FROM master.dbo.spt_monitor
```

## 四、数据库

数据存储页的大小默认8K，实际上会因为扇区大小的缘故，再次拆分问512字节的分割页

### 恢复模式

| 恢复模式  | 功能                                                                                        |
| ----- | ----------------------------------------------------------------------------------------- |
| 完整    | 数据文件丢失或损坏不会导致丢失工作。恢复到特定时间点上，或特定的事务                                                        |
| 大容量日志 | 是完整恢复模式的附加模式，允许执行高性能的大容量复制操作。通过使用最小方式记录大多数大容量操作，减少日志空间使用量。(不完整的记录日志，可能造成数据丢失)             |
| 简单    | 无日志备份(自动截断日志)。自动回收日志空间以减少空间需求，实际上不再需要管理事务日志空间。 最新备份之后的更改不受保护。在发生灾难时，这些更改必须重做。 只能恢复到备份的结尾。 |

一般用完整模式

### 数据页验证算法

| 页验证                 | 功能                                                                                    |
| ------------------- | ------------------------------------------------------------------------------------- |
| CHECKSUM            | 写入数据时，会计算CHECKSUM(数据校验和)，写入页头部，读取数据时通过页头部的CHECKSUM，和数据的CHECKSUM对比，即可得知数据是否完整，只校验逻辑上的页 |
| TORN_PAGE_DETECTION | 分割页检验，每一个分割页都会校验，每当操作系统写一个SQLServer的8K数据页到磁盘时，都必须把数据分成多个512字节的页面。开启会有性能损失，但是更安全       |
| NONE                | 不校验                                                                                   |

### NULL值比较

```sql
SET ANSI_NULLS ON;
```

使`NULL`不可被比较，只可以用`is NULL`或`is not NULL`来查询

### 限制访问

| 限制访问模式          | 功能     |
| --------------- | ------ |
| MULTI_USER      | 多用户    |
| SINGLE_USER     | 单用户    |
| RESTRICTED_USER | 限制用户访问 |

### 使用权限

| 权限  | 功能                        |
| --- | ------------------------- |
| 用户  | 可以访问数据库的对象                |
| 角色  | 分配权限，属于这个角色的用户都可以使用该角色的权限 |

## 五、数据表
